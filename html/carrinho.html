<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho de Compras</title>
    <link rel="stylesheet" href="../css/carrinho.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>
    <!-- Header -->
    <div class="header-container">
        <img src="../assets/images/Logo.jpeg" alt="Logo" class="logo" onclick="window.location.href='index.html'">
        <a href="../index.html" class="back-button">
            <img src="../assets/icons/home.png" alt="Home" style="height: 20px; width: 20px;">
        </a>
    </div>
    <!---- Barra de progresso -->
    <div class="main-content">
        <div class="progress-steps">
            <div class="step active">
                <div class="step-number">1</div>
                <div class="step-text">Carrinho</div>
            </div>
            <div class="step inactive">
                <div class="step-number">2</div>
                <div class="step-text">Dados da encomenda</div>
            </div>
            <div class="step inactive">
                <div class="step-number">3</div>
                <div class="step-text">Finalização</div>
            </div>
        </div>
        
        <h1 class="cart-title">O meu carrinho</h1>
        
        <div class="cart-item">
            <div class="item-image">
                <img src="../assets/images/capacete.jpg" alt="Capacete DELTAPLUS" onerror="this.style.display='none'">
            </div>
            <div class="item-details">
                <div class="item-name">Capacete DELTAPLUS</div>
                <div class="item-ref">Ref 82394287</div>
                <div class="item-price">19.99 €</div>
                
                <div class="item-actions">
                    <div class="quantity-control">
                        <button class="quantity-btn minus">-</button>
                        <input type="number" class="quantity-input" value="1" min="1">
                        <button class="quantity-btn plus">+</button>
                    </div>
                    <button class="remove-btn">
                        <i class="fas fa-trash-alt"></i> Remover
                    </button>
                </div>
            </div>
        </div>

        <div class="totals-section">
            <div class="totals-row">
                <span class="totals-label">SubTotal</span>
                <span class="totals-value" id="subtotal">19.99 €</span>
            </div>
            <div class="totals-row">
                <span class="totals-label">Taxa de entrega</span>
                <span class="totals-value">2.99 €</span>
            </div>
            <div class="totals-row total-row">
                <span class="totals-label">Total</span>
                <span class="totals-value" id="total">22.98 €</span>
            </div>
        </div>

        <a href="dadosentrega.html" class="checkout-button">Preencher dados da encomenda</a>

        <div class="divider"></div>
    </div>


    <footer class="store-footer">
        <div class="store-info">
            <div class="store-name">Brico-Obra: Materiais de Bricolagem e Construção</div>
            
            <div class="social-icons">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
            </div>
            
            <table class="contact-table">
                <tr>
                    <td>Email:</td>
                    <td>brico.obra@sapo.pt</td>
                </tr>
                <tr>
                    <td>Telefone:</td>
                    <td>213 456 789</td>
                </tr>
            </table>
            
            <div class="copyright">
                &copy; 2025 Brico-Obra. Todos os direitos reservados.
            </div>
        </div>
    </footer>
    <script src="../js/carrinho.js"></script>
    <script>
    
    document.addEventListener('DOMContentLoaded', function() {
        
        const quantityInput = document.querySelector('.quantity-input');
        const minusBtn = document.querySelector('.minus');
        const plusBtn = document.querySelector('.plus');
        const itemPriceElement = document.querySelector('.item-price');
        const subtotalElement = document.getElementById('subtotal');
        const deliveryFeeElement = document.querySelector('.totals-value:nth-of-type(2)');
        const totalElement = document.getElementById('total');
        const checkoutButton = document.querySelector('.checkout-button');
        
        
        const unitPrice = 19.99;
        const deliveryFee = 2.99;
        
        // Inicializar valores
        quantityInput.value = 1;
        itemPriceElement.textContent = unitPrice.toFixed(2) + ' €';
        itemPriceElement.dataset.unitPrice = unitPrice;
        updateTotals();
        
        // Função para atualizar totais
        function updateTotals() {
            const quantity = parseInt(quantityInput.value);
            const subtotal = unitPrice * quantity;
            const total = subtotal + deliveryFee;
            
            subtotalElement.textContent = subtotal.toFixed(2) + ' €';
            deliveryFeeElement.textContent = deliveryFee.toFixed(2) + ' €';
            totalElement.textContent = total.toFixed(2) + ' €';
        }
        
        //decremento
        minusBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
                updateTotals();
            }
        });
        
        //incremento
        plusBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            quantityInput.value = currentValue + 1;
            updateTotals();
        });
        
        // Validação do input manual
        quantityInput.addEventListener('change', function() {
            let value = parseInt(this.value);
            if (isNaN(value) || value < 1) {
                this.value = 1;
            }
            updateTotals();
        });
        
        // Armazenar dados ao prosseguir
        checkoutButton.addEventListener('click', function(e) {
            e.preventDefault();

            // quantidade ATUAL do input (not working!!!!!)
            const currentQuantity = parseInt(document.querySelector('.quantity-input').value);

            const cartProduct = {
                quantity: currentQuantity,
                unitPrice: unitPrice,
                subtotal: unitPrice * currentQuantity,
                deliveryFee: deliveryFee,
                total: (unitPrice * currentQuantity) + deliveryFee,
                productName: document.querySelector('.item-name').textContent,
                productRef: document.querySelector('.item-ref').textContent
            };

            localStorage.setItem('cartData', JSON.stringify([cartProduct]));
            window.location.href = 'dadosentrega.html';
        });
    });
</script>
<script>
    // Verifica se o utilizador está autenticado
    if (!sessionStorage.getItem('userLogged')) {
        window.location.href = 'signIn.html';
    }
</script>

</body>
</html>
